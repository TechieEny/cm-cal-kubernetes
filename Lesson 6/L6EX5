
kubectl create deployment nginx --image=nginx

kubectl expose deployment nginx --port=80

kubectl get svc, pod

kubectl run busybox --rm -ti --image=busybox -- /bin/sh

wget --spider --timeout=1 nginx

cat << EOF >> custom-network.yaml
apiVersion: networking.k8s.io/v1
kind: NetworkPolicy
metadata:
  name: access-nginx
spec:
  podSelector:
    matchLabels:
      app: nginx
  ingress:
  - from:
    - podSelector:
        matchLabels:
          access: "true"
EOF

kubectl apply -f custom-network.yaml
kubectl run busybox --rm -ti --image=busybox -- /bin/sh
wget --spider --timeout=1 nginx
kubectl run busybox --rm -ti --labels="access=true" --image=busybox -- /bin/sh
wget --spider --timeout=1 nginx